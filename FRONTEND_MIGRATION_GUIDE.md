# Frontend Migration Guide - Chuy·ªÉn t·ª´ Course-based sang Class-based System

## ‚ùå C√°c thay ƒë·ªïi BREAKING CHANGES

### 1. Course Model Changes
```javascript
// ‚ùå C≈® - Course c√≥ students
{
  _id: "...",
  name: "L·∫≠p tr√¨nh Web",
  code: "IT4409",
  students: [...], // ‚ùå ƒê√£ b·ªã x√≥a
  maxStudents: 100  // ‚ùå ƒê√£ b·ªã x√≥a
}

// ‚úÖ M·ªöI - Course kh√¥ng c√≥ students
{
  _id: "...",
  name: "L·∫≠p tr√¨nh Web", 
  code: "IT4409",
  academicYear: "2024-2025", // ‚úÖ M·ªõi th√™m
  semester: "HK1",           // ‚úÖ M·ªõi th√™m
  credits: 3,                // ‚úÖ M·ªõi th√™m
  classes: [...]             // ‚úÖ Virtual field ch·ª©a c√°c l·ªõp h·ªçc
}
```

### 2. Class Model (Ho√†n to√†n m·ªõi)
```javascript
{
  _id: "...",
  name: "L·∫≠p tr√¨nh Web - L·ªõp 1",
  code: "IT4409_L01",
  course: "COURSE_ID",        // Li√™n k·∫øt v·ªõi Course
  teacher: "TEACHER_ID",
  students: [...],            // ‚úÖ Sinh vi√™n thu·ªôc v·ªÅ Class
  schedule: {
    dayOfWeek: 2,             // 0=CN, 1=T2, ..., 6=T7
    startTime: "08:00",
    endTime: "10:00", 
    room: "P101"
  },
  maxStudents: 35,            // ‚úÖ Gi·ªõi h·∫°n sinh vi√™n c·ªßa l·ªõp
  studentCount: 0             // ‚úÖ Virtual field
}
```

## üîÑ API Changes

### Course APIs
```javascript
// ‚ùå C≈® - Enroll v√†o course
POST /api/courses/:id/enroll     // ‚ùå Deprecated
DELETE /api/courses/:id/enroll   // ‚ùå Deprecated

// ‚úÖ M·ªöI - Th√™m filter theo nƒÉm h·ªçc/h·ªçc k·ª≥
GET /api/courses?academicYear=2024-2025&semester=HK1
GET /api/courses/academic-years
GET /api/courses/semesters?academicYear=2024-2025
GET /api/courses/by-semester?academicYear=2024-2025&semester=HK1
```

### Class APIs (Ho√†n to√†n m·ªõi)
```javascript
// ‚úÖ M·ªöI - Enroll v√†o class
POST /api/classes/:id/enroll     // ‚úÖ S·ª≠ d·ª•ng thay th·∫ø
POST /api/classes/:id/unenroll   // ‚úÖ S·ª≠ d·ª•ng thay th·∫ø

GET /api/classes/by-semester?academicYear=2024-2025&semester=HK1
GET /api/classes?course=COURSE_ID
POST /api/classes                // T·∫°o l·ªõp h·ªçc m·ªõi
PUT /api/classes/:id
DELETE /api/classes/:id
```

### Academic APIs (Ho√†n to√†n m·ªõi)
```javascript
GET /api/academic/overview          // T·ªïng quan h·ªá th·ªëng
GET /api/academic/semester-data     // D·ªØ li·ªáu h·ªçc k·ª≥
GET /api/academic/student-enrollment // L·ªõp h·ªçc ƒë√£ ƒëƒÉng k√Ω
```

## üéØ Frontend Updates Required

### 1. Student Flow - Ch·ªçn l·ªõp h·ªçc thay v√¨ kh√≥a h·ªçc

#### A. Trang ch·ªçn h·ªçc k·ª≥ (M·ªöI)
```typescript
// components/SemesterSelector.tsx
const SemesterSelector = () => {
  const [academicYears, setAcademicYears] = useState([]);
  const [semesters, setSemesters] = useState([]);
  
  // G·ªçi API m·ªõi
  useEffect(() => {
    fetch('/api/academic/overview')
      .then(res => res.json())
      .then(data => setAcademicYears(data.data));
  }, []);
  
  return (
    <div>
      <select onChange={(e) => setSelectedYear(e.target.value)}>
        {academicYears.map(year => (
          <option key={year.academicYear} value={year.academicYear}>
            {year.academicYear}
          </option>
        ))}
      </select>
      
      <select onChange={(e) => setSelectedSemester(e.target.value)}>
        {semesters.map(sem => (
          <option key={sem.semester} value={sem.semester}>
            {sem.semesterName}
          </option>
        ))}
      </select>
    </div>
  );
};
```

#### B. Trang hi·ªÉn th·ªã kh√≥a h·ªçc v√† l·ªõp h·ªçc
```typescript
// ‚ùå C≈® - Enroll tr·ª±c ti·∫øp v√†o course
const enrollCourse = async (courseId) => {
  await fetch(`/api/courses/${courseId}/enroll`, { method: 'POST' });
};

// ‚úÖ M·ªöI - Hi·ªÉn th·ªã classes v√† enroll v√†o class
const CourseList = ({ academicYear, semester }) => {
  const [semesterData, setSemesterData] = useState(null);
  
  useEffect(() => {
    fetch(`/api/academic/semester-data?academicYear=${academicYear}&semester=${semester}`)
      .then(res => res.json())
      .then(data => setSemesterData(data.data));
  }, [academicYear, semester]);
  
  const enrollClass = async (classId) => {
    await fetch(`/api/classes/${classId}/enroll`, { method: 'POST' });
  };
  
  return (
    <div>
      {semesterData?.courses.map(course => (
        <div key={course._id}>
          <h3>{course.name} ({course.credits} t√≠n ch·ªâ)</h3>
          <div>
            {course.classes.map(cls => (
              <div key={cls._id}>
                <h4>{cls.name}</h4>
                <p>L·ªãch: {getDayName(cls.schedule.dayOfWeek)} {cls.schedule.startTime}-{cls.schedule.endTime}</p>
                <p>Ph√≤ng: {cls.schedule.room}</p>
                <p>Sƒ© s·ªë: {cls.studentCount}/{cls.maxStudents}</p>
                <button onClick={() => enrollClass(cls._id)}>
                  ƒêƒÉng k√Ω l·ªõp n√†y
                </button>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
  );
};
```

#### C. Trang xem l·ªõp h·ªçc ƒë√£ ƒëƒÉng k√Ω
```typescript
// ‚úÖ M·ªöI - API xem enrollment
const MyClasses = () => {
  const [enrollment, setEnrollment] = useState(null);
  
  useEffect(() => {
    fetch('/api/academic/student-enrollment')
      .then(res => res.json())
      .then(data => setEnrollment(data.data));
  }, []);
  
  return (
    <div>
      <h2>L·ªõp h·ªçc ƒë√£ ƒëƒÉng k√Ω</h2>
      {enrollment?.enrollmentByTerm.map(term => (
        <div key={`${term.academicYear}-${term.semester}`}>
          <h3>{term.academicYear} - {term.semesterName}</h3>
          <p>T·ªïng t√≠n ch·ªâ: {term.totalCredits}</p>
          {term.classes.map(cls => (
            <div key={cls._id}>
              <h4>{cls.course.name} - {cls.name}</h4>
              <p>L·ªãch: {getDayName(cls.schedule.dayOfWeek)} {cls.schedule.startTime}-{cls.schedule.endTime}</p>
              <p>Ph√≤ng: {cls.schedule.room}</p>
              <button onClick={() => unenrollClass(cls._id)}>
                H·ªßy ƒëƒÉng k√Ω
              </button>
            </div>
          ))}
        </div>
      ))}
    </div>
  );
};
```

### 2. Teacher Flow - T·∫°o kh√≥a h·ªçc v√† l·ªõp h·ªçc

#### A. Form t·∫°o kh√≥a h·ªçc (C·∫¨P NH·∫¨T)
```typescript
// ‚úÖ TH√äM fields m·ªõi
const CreateCourseForm = () => {
  const [formData, setFormData] = useState({
    name: '',
    code: '',
    description: '',
    academicYear: '',      // ‚úÖ M·ªöI
    semester: '',          // ‚úÖ M·ªöI  
    credits: 3             // ‚úÖ M·ªöI
  });
  
  return (
    <form onSubmit={handleSubmit}>
      {/* Existing fields */}
      <input name="name" value={formData.name} onChange={handleChange} />
      <input name="code" value={formData.code} onChange={handleChange} />
      <textarea name="description" value={formData.description} onChange={handleChange} />
      
      {/* ‚úÖ NEW fields */}
      <select name="academicYear" value={formData.academicYear} onChange={handleChange}>
        <option value="2024-2025">2024-2025</option>
        <option value="2025-2026">2025-2026</option>
      </select>
      
      <select name="semester" value={formData.semester} onChange={handleChange}>
        <option value="HK1">H·ªçc k·ª≥ 1</option>
        <option value="HK2">H·ªçc k·ª≥ 2</option>
        <option value="HK_HE">H·ªçc k·ª≥ h√®</option>
      </select>
      
      <input type="number" name="credits" min="1" max="10" 
             value={formData.credits} onChange={handleChange} />
      
      <button type="submit">T·∫°o kh√≥a h·ªçc</button>
    </form>
  );
};
```

#### B. Form t·∫°o l·ªõp h·ªçc (HO√ÄN TO√ÄN M·ªöI)
```typescript
const CreateClassForm = ({ courseId }) => {
  const [formData, setFormData] = useState({
    name: '',
    code: '',
    schedule: {
      dayOfWeek: 1,
      startTime: '08:00',
      endTime: '10:00',
      room: ''
    },
    maxStudents: 35
  });
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    await fetch('/api/classes', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        ...formData,
        course: courseId
      })
    });
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <input name="name" placeholder="T√™n l·ªõp h·ªçc" />
      <input name="code" placeholder="M√£ l·ªõp (t·ª± ƒë·ªông n·∫øu ƒë·ªÉ tr·ªëng)" />
      
      <select name="schedule.dayOfWeek">
        <option value={1}>Th·ª© 2</option>
        <option value={2}>Th·ª© 3</option>
        {/* ... */}
      </select>
      
      <input type="time" name="schedule.startTime" />
      <input type="time" name="schedule.endTime" />
      <input name="schedule.room" placeholder="Ph√≤ng h·ªçc" />
      <input type="number" name="maxStudents" min="1" />
      
      <button type="submit">T·∫°o l·ªõp h·ªçc</button>
    </form>
  );
};
```

### 3. Admin Dashboard Updates

```typescript
// ‚úÖ Dashboard v·ªõi th·ªëng k√™ m·ªõi
const AdminDashboard = () => {
  const [overview, setOverview] = useState([]);
  
  useEffect(() => {
    fetch('/api/academic/overview')
      .then(res => res.json())
      .then(data => setOverview(data.data));
  }, []);
  
  return (
    <div>
      <h1>T·ªïng quan h·ªá th·ªëng</h1>
      {overview.map(year => (
        <div key={year.academicYear}>
          <h2>NƒÉm h·ªçc {year.academicYear}</h2>
          {year.semesters.map(sem => (
            <div key={sem.semester}>
              <h3>{sem.semesterName}</h3>
              <p>Kh√≥a h·ªçc: {sem.courseCount}</p>
              <p>L·ªõp h·ªçc: {sem.classCount}</p>
            </div>
          ))}
        </div>
      ))}
    </div>
  );
};
```

## üö® Migration Checklist

### Backend ‚úÖ DONE
- [x] Course model updated
- [x] Class model created  
- [x] API endpoints updated
- [x] Data migration script
- [x] Documentation

### Frontend üöß TODO
- [ ] Update student enrollment flow
- [ ] Add semester selector component
- [ ] Update course display to show classes
- [ ] Create class management for teachers
- [ ] Update admin dashboard
- [ ] Remove old course enrollment APIs
- [ ] Add class enrollment APIs
- [ ] Test all user flows

### Database üéØ PRIORITY
- [ ] Run migration script on production
- [ ] Create classes for existing courses
- [ ] Manually enroll students into classes
- [ ] Verify data integrity

## üìû Support
N·∫øu c√≥ v·∫•n ƒë·ªÅ g√¨ trong qu√° tr√¨nh migration, vui l√≤ng li√™n h·ªá ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£!
